<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte Ejecutivo | Avances en Atenci칩n al P칰blico</title>
    <!-- Tailwind CSS para un dise침o moderno y responsivo -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts para una tipograf칤a limpia -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Estilo personalizado para la fuente y el carrusel */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* un gris ligeramente m치s azulado */
        }
        /* Estilos para el contenedor del carrusel para ocultar la barra de scroll */
        .carousel-container {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        .carousel-container::-webkit-scrollbar {
            display: none; /* Chrome, Safari and Opera */
        }
        /* Estilos para las ventanas modales */
        .modal, .fullscreen-viewer {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease;
        }
        /* A침adir cursor de zoom a la imagen del modal */
        #modal-image {
            cursor: zoom-in;
            transition: opacity 0.3s ease-in-out;
        }
        /* Estilos para el visor de imagen a pantalla completa */
        #fullscreen-image {
            transition: transform 0.2s ease-out; /* Transici칩n suave para el zoom */
        }
        .draggable {
            cursor: grab;
        }
        .dragging {
            cursor: grabbing;
        }
        /* Oculta el cursor del sistema cuando est치 sobre el visor */
        .fullscreen-viewer {
            cursor: none;
        }
        #custom-cursor {
            transition: border-color 0.2s ease;
        }
    </style>
</head>
<body class="text-gray-800">

    <img src="logo afore coppel.png" alt="Logo Afore Coppel" class="absolute top-8 left-8 h-10 z-20">

    <div class="container mx-auto max-w-6xl py-12 px-4 sm:px-6 lg:px-8">
        <header class="text-center mb-10 pt-12">
            <h1 class="text-3xl md:text-4xl font-bold text-[#004e91] flex items-center justify-center">
                Avances y Mejoras <span class="ml-3 text-3xl">游끥</span>
            </h1>
            <div class="flex justify-center items-center mt-4 space-x-3">
                <span class="text-lg text-gray-600">Implementadas por</span>
                <img src="logo gap.png" alt="Logo Gerencia de Atenci칩n al P칰blico" class="h-28">
            </div>
        </header>

        <!-- Contenedor del Carrusel con botones de navegaci칩n -->
        <div class="relative">
            <main id="carousel-container" class="carousel-container flex overflow-x-auto space-x-6 py-4 px-2 scroll-smooth">
                <!-- Las tarjetas de avances se generar치n din치micamente aqu칤 -->
            </main>

            <!-- Bot칩n de scroll Izquierda -->
            <button id="scroll-left-btn" class="absolute top-1/2 -left-4 md:-left-6 transform -translate-y-1/2 bg-white rounded-full p-2 shadow-lg hover:bg-gray-100 transition z-10">
                <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
            </button>
            
            <!-- Bot칩n de scroll Derecha -->
            <button id="scroll-right-btn" class="absolute top-1/2 -right-4 md:-right-6 transform -translate-y-1/2 bg-white rounded-full p-2 shadow-lg hover:bg-gray-100 transition z-10">
                <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
            </button>
        </div>
        
        <footer class="text-center mt-12 text-gray-500">
            <p>Reporte realizado por la Gerencia de Atenci칩n al P칰blico - Afore Coppel</p>
        </footer>
    </div>

    <!-- Estructura de la Ventana Modal (inicialmente oculta) -->
    <div id="modal" class="modal fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4 opacity-0 pointer-events-none">
        <div id="modal-content" class="modal-content bg-white rounded-xl shadow-2xl w-full max-w-2xl transform scale-95">
            <div class="p-6 md:p-8">
                <div class="flex justify-between items-start mb-4">
                    <h2 id="modal-title" class="text-2xl font-bold text-[#004e91]"></h2>
                    <button id="close-modal-btn" class="text-gray-500 hover:text-gray-800 transition">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>
                <div class="grid md:grid-cols-2 gap-6">
                    <div id="modal-image-container" class="relative">
                        <img id="modal-image" src="" alt="Imagen del Avance" class="rounded-lg w-full h-auto object-cover" onerror="this.onerror=null;this.src='https://placehold.co/600x400/cccccc/ffffff?text=Error%20al%20cargar';">
                        
                        <!-- Botones del carrusel interno (inicialmente ocultos) -->
                        <button id="modal-prev-btn" class="absolute top-1/2 left-2 transform -translate-y-1/2 bg-white/50 rounded-full p-1 shadow-md hover:bg-white/80 transition hidden">
                             <svg class="w-5 h-5 text-gray-800" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                        </button>
                        <button id="modal-next-btn" class="absolute top-1/2 right-2 transform -translate-y-1/2 bg-white/50 rounded-full p-1 shadow-md hover:bg-white/80 transition hidden">
                            <svg class="w-5 h-5 text-gray-800" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </button>
                         <div id="modal-image-dots" class="absolute bottom-2 left-1/2 -translate-x-1/2 flex space-x-2 hidden">
                            <!-- Los puntos se generar치n aqu칤 -->
                        </div>
                    </div>
                    <div class="text-gray-600 space-y-4">
                        <p id="modal-description"></p>
                        <p id="modal-involucrados" class="text-sm text-gray-500"></p>
                        <div id="modal-extra-content"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Estructura del visor de imagen a pantalla completa -->
    <div id="fullscreen-viewer" class="fullscreen-viewer fixed inset-0 bg-black bg-opacity-80 z-[60] flex justify-center items-center p-4 opacity-0 pointer-events-none overflow-hidden">
        <button id="close-fullscreen-btn" class="absolute top-5 right-8 text-white text-5xl font-bold z-[70] cursor-pointer">&times;</button>
        <img id="fullscreen-image" src="" alt="Vista a pantalla completa" class="max-w-full max-h-full rounded-lg object-contain">
        
        <!-- Puntero Personalizado -->
        <div id="custom-cursor" class="absolute w-4 h-4 rounded-full border-2 border-white pointer-events-none transform -translate-x-1/2 -translate-y-1/2 hidden" style="background-color: #ef4444; z-index: 9999;"></div>

        <!-- Controles del Puntero -->
        <div class="absolute bottom-5 left-5 flex items-center space-x-4 z-[80]">
            <!-- Paleta de Colores -->
            <div id="color-palette" class="flex space-x-2">
                <button data-color="#ef4444" class="w-8 h-8 rounded-full bg-red-500 border-2 border-white hover:scale-110 transition-transform cursor-pointer"></button>
                <button data-color="#3b82f6" class="w-8 h-8 rounded-full bg-blue-500 border-2 border-white hover:scale-110 transition-transform cursor-pointer"></button>
                <button data-color="#eab308" class="w-8 h-8 rounded-full bg-yellow-500 border-2 border-white hover:scale-110 transition-transform cursor-pointer"></button>
                <button data-color="#22c55e" class="w-8 h-8 rounded-full bg-green-500 border-2 border-white hover:scale-110 transition-transform cursor-pointer"></button>
            </div>
            <!-- Bot칩n de ON/OFF -->
            <button id="pointer-toggle-btn" class="flex items-center space-x-2 bg-gray-700/50 text-white px-3 py-1.5 rounded-lg text-sm hover:bg-gray-600/70 transition-colors cursor-pointer">
                <span id="pointer-toggle-text">OFF</span>
                <span id="pointer-status" class="w-4 h-4 rounded-full bg-red-500 border-2 border-gray-300"></span>
            </button>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Se usar치n rutas relativas. Aseg칰rate que las im치genes
            // est칠n en la misma carpeta que este archivo HTML.
            const imageBaseUrl = ''; 

            // Datos de los avances
            const avances = [
                {
                    id: 1,
                    titulo: "1. Limitante en CRM",
                    descripcion: "Se agreg칩 una limitante para no poder cambiar de estatus a 'espera interna' un folio CRM sin antes colocarle un comentario. El objetivo es que se tenga una justificaci칩n del cambio de estatus y las 치reas involucradas tengan noci칩n de qu칠 se est치 revisando.",
                    involucrados: "Mesa de Ayuda, Asesores Previsionales, Ejecutivos de Atenci칩n Telef칩nica, Analistas UNE, Ejecutivos GAP, Analistas GAO, Analistas Pensiones, etc.",
                    fecha: "Julio 2025"
                },
                {
                    id: 2,
                    titulo: "2. Env칤o de correos autom치ticos",
                    descripcion: "Se implement칩 un env칤o autom치tico de correo electr칩nico hacia los trabajadores cuando el folio CRM cambie de estatus a 'Espera Interna', eliminando la necesidad de que los Ejecutivos GAP y Analistas UNE lo hagan manualmente. Adicional de la primer notificaci칩n del cambio de estatus, tambi칠n se implement칩 el env칤o autom치tico de correos de seguimiento cada 5, 10, 15, 20 d칤as y peri칩dicamente despu칠s de esos d칤as cada 5 d칤as.",
                    involucrados: "GAP, UNE",
                    fecha: "Octubre 2025"
                },
                {
                    id: 3,
                    titulo: "3. Registro 1ra Interacci칩n",
                    descripcion: "Se implement칩 el registro autom치tico de la fecha de la primera interacci칩n que recibe cada folio CRM, permitiendo un seguimiento preciso del momento en que se contact칩 por primera vez al cliente.",
                    fecha: "Octubre 2025"
                },
                {
                    id: 4,
                    titulo: "4. Gu칤as con IA",
                    descripcion: "Se ha comenzado a utilizar Inteligencia Artificial para generar gu칤as de uso detalladas y f치ciles de entender sobre nuestras herramientas internas, agilizizando la capacitaci칩n y la resoluci칩n de dudas.",
                    fecha: "Octubre 2025"
                },
                {
                    id: 5,
                    titulo: "5. Biblioteca de Scripts",
                    descripcion: "Se cre칩 una Biblioteca de Scripts interna para GAP y UNE. Esta interfaz permite a los agentes buscar y copiar di치logos de respuesta con un solo clic, eficientando los tiempos y unificando el conocimiento entre 치reas.",
                    involucrados: "GAP, UNE",
                    fecha: "Octubre 2025"
                },
                {
                    id: 6,
                    titulo: "6. Asignaci칩n Autom치tica",
                    descripcion: "Se implement칩 una asignaci칩n autom치tica diaria que reduce el proceso de 10-15 minutos manuales a solo 30 segundos con unos pocos clics. El sistema distribuye los folios y genera el reporte al instante.",
                    involucrados: "GAP",
                    images: [ // Nombres de archivo para el carrusel interno (sin %20)
                        "Avance 6.1.jpg",
                        "Avance 6.2.jpg",
                        "Avance 6.3.jpg"
                    ],
                    fecha: "Julio 2025"
                },
                {
                    id: 7,
                    titulo: "7. Adjuntar Archivos CRM",
                    descripcion: "Se habilit칩 en el CRM la opci칩n de adjuntar archivos directamente en el correo de soluci칩n de un caso. Esto elimina el paso anterior de enviar un segundo correo con la documentaci칩n, unificando la comunicaci칩n.",
                    fecha: "Mayo 2025"
                },
                {
                    id: 8,
                    titulo: "8. Retros Interactivas",
                    descripcion: "Se han desarrollado materiales de apoyo y retroalimentaciones interactivas para mejorar la capacitaci칩n y el rendimiento de las 치reas de CAT y Mesa de Ayuda Operaciones.",
                    fecha: "Septiembre 2025"
                },
                {
                    id: 9,
                    titulo: "9. Flyers con IA",
                    descripcion: "Se ha utilizado la Inteligencia Artificial para el dise침o y creaci칩n de flyers informativos, permitiendo comunicar novedades y procedimientos de manera m치s visual y r치pida.",
                    fecha: "Septiembre 2025"
                },
                {
                    id: 10,
                    titulo: "10. Dashboard de Quejas",
                    descripcion: "Se implement칩 un dashboard en Looker para visualizar las quejas de la Subdirecci칩n Comercial. Muestra datos del 2025 filtrados por regiones, estados, y motivos, facilitando el an치lisis y la toma de decisiones.",
                    fecha: "Septiembre 2025"
                },
                {
                    id: 11,
                    titulo: "11. Nuevo Cat치logo Quejas",
                    descripcion: "Se instal칩 un nuevo cat치logo para tipificar quejas en el CRM. Ahora se incluyen campos adicionales como 'Problema', 'Situaci칩n' y 'Canal de Atenci칩n' para un an치lisis m치s detallado y preciso de los motivos de queja.",
                    involucrados: "Todos los usuarios de CRM",
                    fecha: "Octubre 2025"
                }
            ];

            // --- L칍GICA DE ORDENAMIENTO CRONOL칍GICO ---
            const monthMap = {
                'Enero': 0, 'Febrero': 1, 'Marzo': 2, 'Abril': 3, 'Mayo': 4, 'Junio': 5,
                'Julio': 6, 'Agosto': 7, 'Septiembre': 8, 'Octubre': 9, 'Noviembre': 10, 'Diciembre': 11
            };

            avances.forEach(avance => {
                const [monthName, year] = avance.fecha.split(' ');
                avance.dateObject = new Date(year, monthMap[monthName]);
            });

            avances.sort((a, b) => a.dateObject - b.dateObject);


            const carouselContainer = document.getElementById('carousel-container');
            const scrollLeftBtn = document.getElementById('scroll-left-btn');
            const scrollRightBtn = document.getElementById('scroll-right-btn');
            
            const modal = document.getElementById('modal');
            const modalContent = document.getElementById('modal-content');
            const modalTitle = document.getElementById('modal-title');
            const modalImage = document.getElementById('modal-image');
            const modalDescription = document.getElementById('modal-description');
            const modalInvolucrados = document.getElementById('modal-involucrados');
            const modalExtraContent = document.getElementById('modal-extra-content');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const modalPrevBtn = document.getElementById('modal-prev-btn');
            const modalNextBtn = document.getElementById('modal-next-btn');
            const modalImageDots = document.getElementById('modal-image-dots');

            const fullscreenViewer = document.getElementById('fullscreen-viewer');
            const fullscreenImage = document.getElementById('fullscreen-image');
            const closeFullscreenBtn = document.getElementById('close-fullscreen-btn');
            const customCursor = document.getElementById('custom-cursor');
            const colorPalette = document.getElementById('color-palette');
            const pointerToggleBtn = document.getElementById('pointer-toggle-btn');
            const pointerToggleText = document.getElementById('pointer-toggle-text');
            const pointerStatus = document.getElementById('pointer-status');

            let currentImageIndex = 0;
            let currentImageSet = [];

            avances.forEach((avance, index) => {
                const card = document.createElement('div');
                card.className = 'group flex-shrink-0 w-64 h-80 bg-white rounded-xl shadow-lg overflow-hidden cursor-pointer transition-all duration-300 transform hover:scale-105 hover:shadow-2xl';
                card.dataset.index = index; // El 칤ndice ahora corresponde al array ordenado
                
                // Usamos avance.id para mantener la referencia a la imagen original correcta
                const imageUrl = `${imageBaseUrl}Avance ${avance.id}.jpg`; 
                card.innerHTML = `
                    <div class="h-1/2 overflow-hidden">
                        <img src="${imageUrl}" alt="${avance.titulo}" class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110" onerror="this.onerror=null;this.src='https://placehold.co/400x300/cccccc/ffffff?text=Error';">
                    </div>
                    <div class="p-5 h-1/2 flex flex-col justify-center items-center text-center">
                        <h3 class="text-lg font-bold text-gray-800 group-hover:text-[#004e91] transition-colors">${avance.titulo}</h3>
                        <p class="text-sm text-gray-500 mt-2">${avance.fecha}</p>
                    </div>
                `;
                carouselContainer.appendChild(card);
            });
            
            // --- L칍GICA DE CARRUSEL INFINITO ---
            const setupInfiniteCarousel = () => {
                const originalCards = Array.from(carouselContainer.children);
                if (originalCards.length === 0) return;

                originalCards.forEach(card => carouselContainer.appendChild(card.cloneNode(true)));
                originalCards.slice().reverse().forEach(card => carouselContainer.prepend(card.cloneNode(true)));

                const cardWidth = originalCards[0].offsetWidth + 24; 
                const oneBlockWidth = cardWidth * originalCards.length;

                carouselContainer.scrollLeft = oneBlockWidth;

                let isTeleporting = false;
                carouselContainer.addEventListener('scroll', () => {
                    if (isTeleporting) return;
                    if (carouselContainer.scrollLeft >= oneBlockWidth * 2) {
                        isTeleporting = true;
                        carouselContainer.style.scrollBehavior = 'auto';
                        carouselContainer.scrollLeft -= oneBlockWidth;
                    } 
                    else if (carouselContainer.scrollLeft <= 0) {
                        isTeleporting = true;
                        carouselContainer.style.scrollBehavior = 'auto';
                        carouselContainer.scrollLeft += oneBlockWidth;
                    }
                    if (isTeleporting) {
                        setTimeout(() => {
                            carouselContainer.style.scrollBehavior = 'smooth';
                            isTeleporting = false;
                        }, 50);
                    }
                });
            };

            setTimeout(setupInfiniteCarousel, 100); 

            scrollLeftBtn.addEventListener('click', () => { carouselContainer.scrollLeft -= 280; });
            scrollRightBtn.addEventListener('click', () => { carouselContainer.scrollLeft += 280; });

            const updateModalImage = () => {
                if (currentImageSet.length === 0) return;
                
                modalImage.style.opacity = 0;
                setTimeout(() => {
                    modalImage.src = currentImageSet[currentImageIndex];
                    modalImage.style.opacity = 1;
                }, 150);

                modalImageDots.innerHTML = '';
                currentImageSet.forEach((_, index) => {
                    const dot = document.createElement('span');
                    dot.className = `block w-2 h-2 rounded-full cursor-pointer transition-colors ${index === currentImageIndex ? 'bg-white' : 'bg-white/50 hover:bg-white/75'}`;
                    dot.onclick = () => {
                        currentImageIndex = index;
                        updateModalImage();
                    };
                    modalImageDots.appendChild(dot);
                });
            };
            
            modalPrevBtn.addEventListener('click', () => {
                currentImageIndex = (currentImageIndex - 1 + currentImageSet.length) % currentImageSet.length;
                updateModalImage();
            });

            modalNextBtn.addEventListener('click', () => {
                currentImageIndex = (currentImageIndex + 1) % currentImageSet.length;
                updateModalImage();
            });

            const openModal = (index) => {
                const avance = avances[index]; // Obtenemos el avance del array ya ordenado
                modalTitle.textContent = avance.titulo;
                modalDescription.textContent = avance.descripcion;
                
                if (avance.involucrados) {
                    modalInvolucrados.style.display = 'block';
                    let label = "Involucrados";
                    if (avance.id == 1) { // Usamos el ID original para la l칩gica espec칤fica
                        label = "츼reas involucradas en la atenci칩n";
                    }
                    modalInvolucrados.innerHTML = `<strong>${label}:</strong> ${avance.involucrados}`;
                } else {
                    modalInvolucrados.style.display = 'none';
                    modalInvolucrados.innerHTML = '';
                }

                modalExtraContent.innerHTML = '';
                 if (avance.id == 4) { 
                    modalExtraContent.innerHTML = `<a href="https://aforecoppel-ops.github.io/utileria/" target="_blank" rel="noopener noreferrer" class="inline-block mt-2 bg-[#004e91] text-white font-bold py-2 px-4 rounded-lg hover:bg-[#003a6e] transition-colors">Gu칤a de Herramienta</a>`;
                } else if (avance.id == 5) {
                    modalExtraContent.innerHTML = `<a href="https://gap-aforecoppel.github.io/Biblioteca-Scripts/" target="_blank" rel="noopener noreferrer" class="inline-block mt-2 bg-[#004e91] text-white font-bold py-2 px-4 rounded-lg hover:bg-[#003a6e] transition-colors">URL del sitio</a>`;
                } else if (avance.id == 8) { 
                     modalExtraContent.innerHTML = `
                        <div class="flex flex-wrap gap-2 mt-2">
                            <a href="https://gap-aforecoppel.github.io/ConsultaSQL/" target="_blank" rel="noopener noreferrer" class="inline-block bg-[#004e91] text-white font-bold py-2 px-4 rounded-lg hover:bg-[#003a6e] transition-colors">
                                Retro MSO
                            </a>
                            <a href="https://aforecoppel-ops.github.io/Seguimiento-retiros-parciales/" target="_blank" rel="noopener noreferrer" class="inline-block bg-[#004e91] text-white font-bold py-2 px-4 rounded-lg hover:bg-[#003a6e] transition-colors">
                                Retro CAT
                            </a>
                        </div>
                    `;
                } else if (avance.id == 9) { 
                    modalExtraContent.innerHTML = `<a href="https://aforecoppel-ops.github.io/Identificaciones-Validas/" target="_blank" rel="noopener noreferrer" class="inline-block mt-2 bg-[#004e91] text-white font-bold py-2 px-4 rounded-lg hover:bg-[#003a6e] transition-colors">Flyer Interactivo</a>`;
                } else if (avance.id == 10) { 
                    modalExtraContent.innerHTML = `<a href="https://lookerstudio.google.com/reporting/e88486b7-7aeb-404f-9e27-57a97492f11a/page/1I5XF" target="_blank" rel="noopener noreferrer" class="inline-block mt-2 bg-[#004e91] text-white font-bold py-2 px-4 rounded-lg hover:bg-[#003a6e] transition-colors">Looker Quejas</a>`;
                }


                if (avance.images && avance.images.length > 0) {
                    currentImageSet = avance.images.map(imgName => imageBaseUrl + imgName); 
                    currentImageIndex = 0;
                    updateModalImage();
                    modalPrevBtn.classList.remove('hidden');
                    modalNextBtn.classList.remove('hidden');
                    modalImageDots.classList.remove('hidden');
                } else {
                    currentImageSet = [];
                    modalPrevBtn.classList.add('hidden');
                    modalNextBtn.classList.add('hidden');
                    modalImageDots.classList.add('hidden');
                    const imageUrl = `${imageBaseUrl}Avance ${avance.id}.jpg`;
                    modalImage.src = imageUrl;
                    modalImage.alt = `${avance.titulo}`;
                }

                modal.classList.remove('opacity-0', 'pointer-events-none');
                modalContent.classList.remove('scale-95');
            };

            const closeModal = () => {
                modal.classList.add('opacity-0', 'scale-95');
                setTimeout(() => modal.classList.add('pointer-events-none'), 300);
            };

            carouselContainer.addEventListener('click', (e) => {
                const card = e.target.closest('.group');
                if (card && card.dataset.index) {
                    openModal(card.dataset.index);
                }
            });

            closeModalBtn.addEventListener('click', closeModal);
            modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });

            // --- L칍GICA PARA ZOOM, ARRASTRE Y PUNTERO PERSONALIZADO ---
            let scale = 1, isDragging = false, startX, startY, x = 0, y = 0;
            let paintModeActive = false;
            let currentPointerColor = '#ef4444';

            const openFullscreen = (src) => {
                fullscreenImage.src = src;
                scale = 1; x = 0; y = 0;
                fullscreenImage.style.transform = `translate(0px, 0px) scale(1)`;
                fullscreenViewer.classList.remove('opacity-0', 'pointer-events-none');
                customCursor.classList.remove('hidden');
                window.addEventListener('mousemove', handleFullscreenMouseMove);
                window.addEventListener('mouseup', handleFullscreenMouseUp);
            };

            const closeFullscreen = () => {
                fullscreenViewer.classList.add('opacity-0');
                setTimeout(() => {
                    fullscreenViewer.classList.add('pointer-events-none');
                    customCursor.classList.add('hidden');
                    paintModeActive = false;
                    pointerToggleText.textContent = 'OFF';
                    pointerStatus.classList.remove('bg-green-500');
                    pointerStatus.classList.add('bg-red-500');
                    window.removeEventListener('mousemove', handleFullscreenMouseMove);
                    window.removeEventListener('mouseup', handleFullscreenMouseUp);
                }, 300);
            };
            
            modalImage.addEventListener('click', () => openFullscreen(modalImage.src));
            closeFullscreenBtn.addEventListener('click', closeFullscreen);
            fullscreenViewer.addEventListener('click', (e) => { 
                if (e.target === fullscreenViewer && !isDragging) closeFullscreen(); 
            });

            fullscreenViewer.addEventListener('wheel', (e) => {
                e.preventDefault();
                const delta = e.deltaY > 0 ? -0.1 : 0.1;
                scale = Math.max(0.5, Math.min(scale + delta, 5));
                fullscreenImage.style.transform = `translate(${x}px, ${y}px) scale(${scale})`;
            });
            
            fullscreenImage.addEventListener('mousedown', (e) => {
                if (scale > 1 && e.button === 0) {
                    e.preventDefault();
                    isDragging = true;
                    startX = e.clientX - x;
                    startY = e.clientY - y;
                    fullscreenImage.classList.add('dragging');
                }
            });

            function handleFullscreenMouseMove(e) {
                customCursor.style.left = `${e.clientX}px`;
                customCursor.style.top = `${e.clientY}px`;

                if (paintModeActive && !isDragging) {
                    const trailDot = document.createElement('div');
                    trailDot.className = 'absolute rounded-full pointer-events-none';
                    trailDot.style.backgroundColor = currentPointerColor;
                    trailDot.style.left = `${e.clientX}px`;
                    trailDot.style.top = `${e.clientY}px`;
                    trailDot.style.width = '12px';
                    trailDot.style.height = '12px';
                    trailDot.style.transform = 'translate(-50%, -50%)';
                    trailDot.style.zIndex = '9998';
                    trailDot.style.transition = 'transform 0.5s ease-out, opacity 0.5s ease-out';
                    
                    fullscreenViewer.appendChild(trailDot);

                    requestAnimationFrame(() => {
                        trailDot.style.transform = 'translate(-50%, -50%) scale(0)';
                        trailDot.style.opacity = '0';
                    });

                    setTimeout(() => {
                        trailDot.remove();
                    }, 500);
                }
                
                if (isDragging) {
                    x = e.clientX - startX;
                    y = e.clientY - startY;
                    fullscreenImage.style.transform = `translate(${x}px, ${y}px) scale(${scale})`;
                }
            }

            function handleFullscreenMouseUp() {
                if(isDragging) {
                    isDragging = false;
                    fullscreenImage.classList.remove('dragging');
                }
            }

            colorPalette.addEventListener('click', (e) => {
                e.stopPropagation();
                const button = e.target.closest('button');
                if (button && button.dataset.color) {
                    currentPointerColor = button.dataset.color;
                    customCursor.style.backgroundColor = currentPointerColor;
                }
            });

            pointerToggleBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                paintModeActive = !paintModeActive;
                if (paintModeActive) {
                    pointerToggleText.textContent = 'ON';
                    pointerStatus.classList.remove('bg-red-500');
                    pointerStatus.classList.add('bg-green-500');
                } else {
                    pointerToggleText.textContent = 'OFF';
                    pointerStatus.classList.remove('bg-green-500');
                    pointerStatus.classList.add('bg-red-500');
                }
            });
        });
    </script>
</body>
</html>

